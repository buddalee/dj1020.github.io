
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle | 閃亮亮大師之路</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="閃亮亮dj">
    

    
    <meta name="description" content="案例前置作業按此 查看已完成的 Git 源碼，過程有問題可到 Laravel 台灣臉書社團 發問
建立專案資料夾 mkdir ch10_LSP_demo，cd ch10_LSP_demo 切到專案目錄下
(optional) 初始化 git 做版本控制 git init
使用 Composer 建立 psr-4 開發環境，comopser init，並設定 { &amp;quot;autoload&amp;quo">
<meta property="og:type" content="article">
<meta property="og:title" content="Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle">
<meta property="og:url" content="http://blog.dj1020.net/Laradiner讀書會-SOLID-原則(3)-Liskov-Substitution-Principle-2016-05-26/index.html">
<meta property="og:site_name" content="閃亮亮大師之路">
<meta property="og:description" content="案例前置作業按此 查看已完成的 Git 源碼，過程有問題可到 Laravel 台灣臉書社團 發問
建立專案資料夾 mkdir ch10_LSP_demo，cd ch10_LSP_demo 切到專案目錄下
(optional) 初始化 git 做版本控制 git init
使用 Composer 建立 psr-4 開發環境，comopser init，並設定 { &amp;quot;autoload&amp;quo">
<meta property="og:updated_time" content="2016-05-25T15:48:04.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle">
<meta name="twitter:description" content="案例前置作業按此 查看已完成的 Git 源碼，過程有問題可到 Laravel 台灣臉書社團 發問
建立專案資料夾 mkdir ch10_LSP_demo，cd ch10_LSP_demo 切到專案目錄下
(optional) 初始化 git 做版本控制 git init
使用 Composer 建立 psr-4 開發環境，comopser init，並設定 { &amp;quot;autoload&amp;quo">

    
    <link rel="alternative" href="/atom.xml" title="閃亮亮大師之路" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="閃亮亮大師之路" title="閃亮亮大師之路"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="閃亮亮大師之路">閃亮亮大師之路</a></h1>
				<h2 class="blog-motto">程式學習心得筆記</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
						<li><a href="/about">About</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:blog.dj1020.net">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/Laradiner讀書會-SOLID-原則(3)-Liskov-Substitution-Principle-2016-05-26/" title="Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle" itemprop="url">Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="閃亮亮dj" target="_blank" itemprop="author">閃亮亮dj</a>
		
  <p class="article-time">
    <time datetime="2016-05-25T08:40:03.000Z" itemprop="datePublished"> 發表於 2016-05-25</time>
  </p>

  
    <div class="article-share clearfix" id="share">
    
      <div data-url="http://blog.dj1020.net/Laradiner讀書會-SOLID-原則(3)-Liskov-Substitution-Principle-2016-05-26/" data-title="Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle | 閃亮亮大師之路" data-tsina="null" class="share clearfix">
      </div>
    
    </div>
  

</header>
	<div class="article-content">
		
		<h2 id="u6848_u4F8B_u524D_u7F6E_u4F5C_u696D"><a href="#u6848_u4F8B_u524D_u7F6E_u4F5C_u696D" class="headerlink" title="案例前置作業"></a>案例前置作業</h2><h4 id="u6309_u6B64__u67E5_u770B_u5DF2_u5B8C_u6210_u7684_Git__u6E90_u78BC_uFF0C_u904E_u7A0B_u6709_u554F_u984C_u53EF_u5230_Laravel__u53F0_u7063_u81C9_u66F8_u793E_u5718__u767C_u554F"><a href="#u6309_u6B64__u67E5_u770B_u5DF2_u5B8C_u6210_u7684_Git__u6E90_u78BC_uFF0C_u904E_u7A0B_u6709_u554F_u984C_u53EF_u5230_Laravel__u53F0_u7063_u81C9_u66F8_u793E_u5718__u767C_u554F" class="headerlink" title="按此 查看已完成的 Git 源碼，過程有問題可到 Laravel 台灣臉書社團 發問"></a><a href="https://github.com/dj1020/CH10_Liskov_Substitution_Principle_LSP_demo" target="_blank" rel="external">按此</a> 查看已完成的 Git 源碼，過程有問題可到 <a href="https://www.facebook.com/groups/laravel.tw/" target="_blank" rel="external">Laravel 台灣臉書社團</a> 發問</h4><ol>
<li>建立專案資料夾 <code>mkdir ch10_LSP_demo</code>，<code>cd ch10_LSP_demo</code> 切到專案目錄下</li>
<li>(optional) 初始化 git 做版本控制 <code>git init</code></li>
<li>使用 Composer 建立 psr-4 開發環境，<code>comopser init</code>，並設定 <code>{ &quot;autoload&quot;: { &quot;psr-4&quot; : { &quot;Twk\\&quot; : &quot;src/&quot; } }</code></li>
<li>建立 <code>src/index.php</code> 做為 client 進入點</li>
<li>在 <code>index.php</code> 建立 <code>Main</code> class 並把書中範例程式碼實作，額外的程式只有實際需要才寫，好了記得 commit 一次。</li>
<li>執行 <code>composer dump</code> (等同 <code>composer dumpautoload</code> or <code>composer dump-autoload</code>)，會產生 <code>vendor</code> 資料夾，及 <code>vendor/autoload.php</code> 檔。</li>
<li>在 <code>index.php</code> 中 require <code>vendor/autoload.php</code>，即可使用所有 <code>composer require</code> 所安裝的套件。</li>
<li>以解 bug 的方式，一步步來完成實作，執行 <code>php index.php</code> 或是以開網頁方式打開 <code>index.php</code> 皆可</li>
<li>建立 <code>CsvOrderRepository</code> Class</li>
<li>建立 <code>OrderRepositoryInterface</code>，並讓 <code>CsvOrderRepository</code> 繼承(implements) <code>OrderRepositoryInterface</code></li>
<li>建立 <code>Order</code> class</li>
<li>建立 <code>logOrder</code> method 在 <code>OrderRepositoryInterface</code>，並在 <code>CsvOrderRepository</code> 中實作</li>
<li>其他詳細流程可以到 Laradiner 讀書會看閃亮亮 LiveDemo 或參考 GitHub 中的 <a href="https://github.com/dj1020/CH10_Liskov_Substitution_Principle_LSP_demo/commits/master" target="_blank" rel="external">commit history</a>，Done。</li>
</ol>
<h2 id="u91CC_u6C0F_u66FF_u63DB_u539F_u5247__28LSP_-_Liskov_Substitution_Principle_29"><a href="#u91CC_u6C0F_u66FF_u63DB_u539F_u5247__28LSP_-_Liskov_Substitution_Principle_29" class="headerlink" title="里氏替換原則 (LSP - Liskov Substitution Principle)"></a>里氏替換原則 (LSP - Liskov Substitution Principle)</h2><p>別擔心，LSP 原則沒有你想像的那麼複雜。簡單來說，就是你如果有一個類別(class)實作(implements)了一個介面(interface)，那任何使用這個介面(interface)的地方，底下的實作類別(class)應該都可以被抽換成另一個有實作(implements)該介面(interface)的類別(class)，而不需要修改原本的程式碼就能正常運作，這也同時符合了(OCP, Open Close Principle)原則。</p>
<p>換句話說，你只要違反了 LSP，通常就表示你也違反了 OCP。這會讓你的程式碼很難維護，容易改東錯西。</p>
<p>如果用 pseudo code 來表示，大概是像這樣：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyCar</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyCar runs</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyPlane</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyPlane runs</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">(Toy <span class="variable">$toy</span>)</span> </span>&#123;</span><br><span class="line">        <span class="variable">$toy</span>-&gt;run();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$toyA</span> = <span class="keyword">new</span> ToyCar();</span><br><span class="line"><span class="variable">$toyB</span> = <span class="keyword">new</span> ToyPlane();</span><br><span class="line"></span><br><span class="line"><span class="variable">$child</span> = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="variable">$child</span>-&gt;play(<span class="variable">$toyA</span>);</span><br></pre></td></tr></table></figure>
<p>如果你寫的 code 完全有符合 LSP，<code>$toyA</code> 換成 <code>$toyB</code> 你的程式應該還是要能正常執行。</p>
<p><br></p>
<blockquote>
<font size="+2">替換實作的類別時，不用修改使用該類別的 caller 的程式碼</font>

</blockquote>
<p><br></p>
<h4 id="u6700_u5E38_u898B_u7684_u932F_u8AA4_uFF1A"><a href="#u6700_u5E38_u898B_u7684_u932F_u8AA4_uFF1A" class="headerlink" title="最常見的錯誤："></a>最常見的錯誤：</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyCar</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyCar on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyCar off</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyCar runs</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyPlane</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyPlane on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyPlane off</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">fly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyPlane flys</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">(Toy <span class="variable">$toy</span>)</span> </span>&#123;</span><br><span class="line">        <span class="variable">$toy</span>-&gt;on();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ( <span class="variable">$toy</span> <span class="keyword">instanceof</span> ToyCar ) &#123;</span><br><span class="line">            <span class="variable">$toy</span>-&gt;run();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> ( <span class="variable">$toy</span> <span class="keyword">instanceof</span> ToyPlane ) &#123;</span><br><span class="line">            <span class="variable">$toy</span>-&gt;fly();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$toy</span>-&gt;off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$toyA</span> = <span class="keyword">new</span> ToyCar();</span><br><span class="line"><span class="variable">$toyB</span> = <span class="keyword">new</span> ToyPlane();</span><br><span class="line"></span><br><span class="line"><span class="variable">$child</span> = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="variable">$child</span>-&gt;play(<span class="variable">$toyA</span>);</span><br></pre></td></tr></table></figure>
<p>你會說，這樣，我的 $toyA 換成 $toyB 完全沒有問題啊，我有符合 LSP。喔！不不不，那要是你再增加一種 $toyC 是會說話的玩具熊呢？</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyBear</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyBear on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyBear off</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">talk</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyBear talks</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>按照 LSP 原則，既然你的 $toyA, $toyB, $toyC 都實作了 Toy 介面，那麼這三個 instances 應該要可以互換，而且不影響到 Caller 也就是 Child Class 中的程式碼，就可以正常運作才是。很顯然地，你必需修改 Child Class 中的 play method 才能讓你的 child 可以玩玩具熊，那就是違反了 LSP。</p>
<h4 id="u600E_u9EBC_u89E3_uFF1F"><a href="#u600E_u9EBC_u89E3_uFF1F" class="headerlink" title="怎麼解？"></a>怎麼解？</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyCar</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyCar on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyCar off</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyCar runs</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyPlane</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyPlane on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyPlane off</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyPlane flys</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ToyBear</span> <span class="keyword">implements</span> <span class="title">Toy</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">on</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyBear on</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">off</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// Turn ToyBear off</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// ToyBear talks</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Child</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">play</span><span class="params">(Toy <span class="variable">$toy</span>)</span> </span>&#123;</span><br><span class="line">        <span class="variable">$toy</span>-&gt;on();</span><br><span class="line">        <span class="variable">$toy</span>-&gt;start();</span><br><span class="line">        <span class="variable">$toy</span>-&gt;off();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$toyA</span> = <span class="keyword">new</span> ToyCar();</span><br><span class="line"><span class="variable">$toyB</span> = <span class="keyword">new</span> ToyPlane();</span><br><span class="line"><span class="variable">$toyC</span> = <span class="keyword">new</span> ToyBear();</span><br><span class="line"></span><br><span class="line"><span class="variable">$child</span> = <span class="keyword">new</span> Child();</span><br><span class="line"><span class="variable">$child</span>-&gt;play(<span class="variable">$toyA</span>);  <span class="comment">// 現在，可以換成 $toyB, $toyC 都還是能正常執行了。</span></span><br></pre></td></tr></table></figure>
<h2 id="u73FE_u5728_u8B93_u6211_u5011_u56DE_u5230_u66F8_u4E2D_u7684_u7BC4_u4F8B_uFF1A"><a href="#u73FE_u5728_u8B93_u6211_u5011_u56DE_u5230_u66F8_u4E2D_u7684_u7BC4_u4F8B_uFF1A" class="headerlink" title="現在讓我們回到書中的範例："></a>現在讓我們回到書中的範例：</h2><p>這裡把一些書中沒有實作的部份都實作出來，目的不是給已經懂的人看，是給一些還沒辦法從書中不完整的範例想像整座森林的人，應該會有所幫助。這次就不用 Laravel 專案舉例，希望能更親切一些。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(OrderRepositoryInterface <span class="variable">$orders</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;orders = <span class="variable">$orders</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">(Order <span class="variable">$order</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">       <span class="variable">$this</span>-&gt;orders-&gt;logOrder(<span class="variable">$order</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CsvOrderRepository</span> <span class="keyword">implements</span> <span class="title">OrderRepositoryInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$logFile</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(<span class="variable">$logFile</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;logFile = <span class="keyword">__DIR__</span> . <span class="string">"/storage/$logFile"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">logOrder</span><span class="params">(Order <span class="variable">$order</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$fp</span> = fopen(<span class="variable">$this</span>-&gt;logFile, <span class="string">'a'</span>);</span><br><span class="line">        fputcsv(<span class="variable">$fp</span>, [</span><br><span class="line">            <span class="string">'id'</span> =&gt; <span class="variable">$order</span>-&gt;id,</span><br><span class="line">            <span class="string">'amount'</span> =&gt; <span class="variable">$order</span>-&gt;amount,</span><br><span class="line">        ]);</span><br><span class="line">        fclose(<span class="variable">$fp</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Order</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$id</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$amount</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(<span class="variable">$id</span>, <span class="variable">$amount</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;id = <span class="variable">$id</span>;</span><br><span class="line">        <span class="variable">$this</span>-&gt;amount = <span class="variable">$amount</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">(<span class="variable">$property</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (property_exists(<span class="variable">$this</span>, <span class="variable">$property</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$this</span>-&gt;<span class="variable">$property</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="keyword">Exception</span>(<span class="string">'No such property'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$orderRepository</span> = <span class="keyword">new</span> CsvOrderRepository(<span class="string">'orders.log'</span>);</span><br><span class="line"><span class="variable">$main</span> = <span class="keyword">new</span> Main(<span class="variable">$orderRepository</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$order</span> = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable">$main</span>-&gt;process(<span class="variable">$order</span>);</span><br></pre></td></tr></table></figure>
<p>書上提到，現在因為資料量的上升，所以只用 csv 來做為訂單的 Log 記錄已經不夠，所以需要把資料寫入資料庫中儲存，我們需要替換 <code>OrderRepositoryInterface</code> 的實作類別，所以寫了下面這些 Code，實作了 <code>DatabaseOrderRepository</code> 和 <code>DatabaseConnection</code> 類別。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseOrderRepository</span> <span class="keyword">implements</span> <span class="title">OrderRepositoryInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$connection</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">(<span class="variable">$username</span>, <span class="variable">$password</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;connection = <span class="keyword">new</span> DatabaseConnection(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">logOrder</span><span class="params">(Order <span class="variable">$order</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        var_dump(<span class="string">"Log order &#123;$order-&gt;id&#125; in database."</span>);</span><br><span class="line">        <span class="variable">$this</span>-&gt;connection-&gt;run(<span class="string">'insert into orders values (?, ?)'</span>, [</span><br><span class="line">            <span class="variable">$order</span>-&gt;id,</span><br><span class="line">            <span class="variable">$order</span>-&gt;amount,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseConnection</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(<span class="variable">$username</span>, <span class="variable">$password</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// 略</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">(<span class="variable">$sql</span>, <span class="variable">$params</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        var_dump(<span class="string">"SQL: $sql\n, Parmas: "</span> . var_export(<span class="variable">$params</span>, <span class="keyword">true</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>並且準備替換原本的 <code>CsvOrderRepository</code> ，如下：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $orderRepository = new CsvOrderRepository('orders.log');</span></span><br><span class="line"><span class="variable">$orderRepository</span> = <span class="keyword">new</span> DatabaseOrderRepository(<span class="string">'username'</span>, <span class="string">'password'</span>);</span><br><span class="line"><span class="variable">$main</span> = <span class="keyword">new</span> Main(<span class="variable">$orderRepository</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$order</span> = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable">$main</span>-&gt;process(<span class="variable">$order</span>);</span><br></pre></td></tr></table></figure>
<p>執行後馬上報錯：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Fatal error: <span class="operator"><span class="keyword">Call</span> <span class="keyword">to</span> a <span class="keyword">member</span> <span class="keyword">function</span> run() <span class="keyword">on</span> <span class="literal">null</span> <span class="keyword">in</span> /<span class="keyword">Users</span>/twinkledj/Projects/Laradiner/ch10_LSP_demo/src/DatabaseOrderRepository.php <span class="keyword">on</span> line <span class="number">15</span></span></span><br></pre></td></tr></table></figure>
<p>原來是忘了呼叫 <code>DatabaseOrderRepository</code> 中的 <code>connect()</code> 來初始化資料庫連線，好，那我們為了符合 LSP 原則，我們就改成這樣：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前同，略</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">(Order <span class="variable">$order</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="comment">// 加入判斷是不是存到資料庫的 repository</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$order</span> <span class="keyword">instanceof</span> DatabaseOrderRepository) &#123;</span><br><span class="line">            <span class="variable">$order</span>-&gt;connect();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="variable">$this</span>-&gt;orders-&gt;logOrder(<span class="variable">$order</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$orderRepository</span> = <span class="keyword">new</span> DatabaseOrderRepository(<span class="string">'usernmae'</span>, <span class="string">'password'</span>);</span><br><span class="line"><span class="variable">$main</span> = <span class="keyword">new</span> Main(<span class="variable">$orderRepository</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$order</span> = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable">$main</span>-&gt;process(<span class="variable">$order</span>);</span><br></pre></td></tr></table></figure>
<p>這樣的話，不論使用 <code>CsvOrderRepository</code> 或 <code>DatabaseOrderRepository</code> 都可以了唷！好像完全符合了 LSP 對吧 …</p>
<p><br></p>
<blockquote>
<font size="+2">悲劇，在你修改 Main Class 的那一瞬間，你就違反了 LSP 了！</font>

</blockquote>
<p><br></p>
<p>不是說完全不能違反 LSP，我聽 Jeffrey Way 講他有時也會違反 LSP，但只有確定在好處多於壞處，或是你能確定某些特定的條件下才使用，有意識、有理由的違反 LSP。還不完全理解的話，先儘可能符合 LSP 吧！會讓你的程式碼維護之路好走上百倍。</p>
<h2 id="u600E_u9EBC_u89E3_uFF1F_u89E3_u6CD5_u4E00_uFF1A"><a href="#u600E_u9EBC_u89E3_uFF1F_u89E3_u6CD5_u4E00_uFF1A" class="headerlink" title="怎麼解？解法一："></a>怎麼解？解法一：</h2><p>其實解法不是只有書中的一種，反正最高指導原則就是完全不要去碰 Main Class 的任何 Code，但畢竟資料庫連線還是要初始化啊！不然該怎麼辦？我想最簡單的方法應該是：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseOrderRepository</span> <span class="keyword">implements</span> <span class="title">OrderRepositoryInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 前略</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">(<span class="variable">$username</span>, <span class="variable">$password</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;connection = <span class="keyword">new</span> DatabaseConnection(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 後略</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(OrderRepositoryInterface <span class="variable">$orders</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;orders = <span class="variable">$orders</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">process</span><span class="params">(Order <span class="variable">$order</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;orders-&gt;logOrder(<span class="variable">$order</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$orderRepository</span> = (<span class="keyword">new</span> DatabaseOrderRepository(<span class="string">'usernmae'</span>, <span class="string">'password'</span>))-&gt;connect();</span><br><span class="line"><span class="variable">$main</span> = <span class="keyword">new</span> Main(<span class="variable">$orderRepository</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$order</span> = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable">$main</span>-&gt;process(<span class="variable">$order</span>);</span><br></pre></td></tr></table></figure>
<h4 id="u6211_u628A_u521D_u59CB_u5316_u7684_u52D5_u4F5C_u5F80_u4E0A_u62C9_uFF0C_u5728_u4E00_u958B_u59CB_u5C31_u521D_u59CB_u5316_uFF0C_u518D_u50B3_u5165_Main__u4E2D_u3002_u641E_u5B9A_uFF01"><a href="#u6211_u628A_u521D_u59CB_u5316_u7684_u52D5_u4F5C_u5F80_u4E0A_u62C9_uFF0C_u5728_u4E00_u958B_u59CB_u5C31_u521D_u59CB_u5316_uFF0C_u518D_u50B3_u5165_Main__u4E2D_u3002_u641E_u5B9A_uFF01" class="headerlink" title="我把初始化的動作往上拉，在一開始就初始化，再傳入 Main 中。搞定！"></a>我把初始化的動作往上拉，在一開始就初始化，再傳入 Main 中。搞定！</h4><p>是不是一定要用書中的解法，我覺得不見得，看你有多少時間，還有需不需要吧。</p>
<h2 id="u81F3_u65BC_u66F8_u4E2D_u89E3_u6CD5_u7684_u5B8C_u6574_u7BC4_u4F8B_u662F_u600E_u6A23_uFF1F_u89E3_u6CD5_u4E8C_uFF1A"><a href="#u81F3_u65BC_u66F8_u4E2D_u89E3_u6CD5_u7684_u5B8C_u6574_u7BC4_u4F8B_u662F_u600E_u6A23_uFF1F_u89E3_u6CD5_u4E8C_uFF1A" class="headerlink" title="至於書中解法的完整範例是怎樣？解法二："></a>至於書中解法的完整範例是怎樣？解法二：</h2><p>請大家看 Code，當然，有來讀書會的朋友才聽得到我揀重點講的部份，看文章的話就請自行細細品味囉~</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseOrderRepository</span> <span class="keyword">implements</span> <span class="title">OrderRepositoryInterface</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$connector</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(DatabaseConnector <span class="variable">$connector</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;connector = <span class="variable">$connector</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>-&gt;connector-&gt;bootConnection();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">logOrder</span><span class="params">(Order <span class="variable">$order</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        var_dump(<span class="string">"Log order &#123;$order-&gt;id&#125; in database."</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$connection</span> = <span class="variable">$this</span>-&gt;connect();</span><br><span class="line"></span><br><span class="line">        <span class="variable">$connection</span>-&gt;run(<span class="string">'insert into orders values (?, ?)'</span>, [</span><br><span class="line">            <span class="variable">$order</span>-&gt;id,</span><br><span class="line">            <span class="variable">$order</span>-&gt;amount,</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u600E_u9EBC_u5BE6_u4F5C_DatabaseConnector__u5462_uFF1F"><a href="#u600E_u9EBC_u5BE6_u4F5C_DatabaseConnector__u5462_uFF1F" class="headerlink" title="怎麼實作 DatabaseConnector 呢？"></a>怎麼實作 DatabaseConnector 呢？</h4><p>寫給大家參考參考，順便把前面寫的 <code>DatabaseConnection</code> 也拿來用。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DatabaseConnector</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$connection</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(<span class="variable">$username</span>, <span class="variable">$password</span>)</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="variable">$this</span>-&gt;username = <span class="variable">$username</span>;</span><br><span class="line">        <span class="variable">$this</span>-&gt;password = <span class="variable">$password</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">bootConnection</span><span class="params">()</span></span><br><span class="line">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (is_null(<span class="variable">$this</span>-&gt;connection)) &#123;</span><br><span class="line">            <span class="variable">$this</span>-&gt;connection = <span class="variable">$this</span>-&gt;connect(<span class="variable">$this</span>-&gt;username, <span class="variable">$this</span>-&gt;password);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$this</span>-&gt;connection;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span><span class="params">(<span class="variable">$username</span>, <span class="variable">$password</span>)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DatabaseConnection(<span class="variable">$username</span>, <span class="variable">$password</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="u6700_u5F8C_u5C31_u662F_u600E_u9EBC_u547C_u53EB_u4F7F_u7528_uFF1F"><a href="#u6700_u5F8C_u5C31_u662F_u600E_u9EBC_u547C_u53EB_u4F7F_u7528_uFF1F" class="headerlink" title="最後就是怎麼呼叫使用？"></a>最後就是怎麼呼叫使用？</h4><p>這邊往往是新手比較無法自行想像，又找不到 google 可以問的部份，希望對你們有幫助，但其實真的不用想得太難，就這樣：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$orderRepository</span> = <span class="keyword">new</span> DatabaseOrderRepository(<span class="keyword">new</span> DatabaseConnector(<span class="string">'homestead'</span>, <span class="string">'secret'</span>));</span><br><span class="line"><span class="variable">$main</span> = <span class="keyword">new</span> Main(<span class="variable">$orderRepository</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$order</span> = <span class="keyword">new</span> Order(<span class="number">1</span>, <span class="number">100</span>);</span><br><span class="line"><span class="variable">$main</span>-&gt;process(<span class="variable">$order</span>);</span><br></pre></td></tr></table></figure>
<h2 id="u9583_u4EAE_u4EAE_u5C0F_u7D50"><a href="#u9583_u4EAE_u4EAE_u5C0F_u7D50" class="headerlink" title="閃亮亮小結"></a>閃亮亮小結</h2><p>書裡這個章節的末段提到的 <code>knowledge</code>，講得觀念其實就是 Law of Demeter 有人翻成「迪米特法則」，又稱「最小知識原則」，和 LSP 是有一定相關性的。像是一開始修改 Main Class 的時候這一段：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="variable">$order</span> <span class="keyword">instanceof</span> DatabaseOrderRepository) &#123;</span><br><span class="line">    <span class="variable">$order</span>-&gt;connect();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>這邊就是書中所謂的 “leaky abstrations”，這段程式碼向 <code>Main</code> Class 透露了它不需要知道的細節，也就是 判斷 <code>$order</code> 的實作類別是不是 <code>DatabaseOrderRepository</code> 的這件事，這 Main Class 應該根本不該去判斷，這就違反了 Law of Demeter (LoD) 原則。如何讓你的 Caller 儘可能少知道不需要的資訊，是寫程式的禪啊~~</p>
<p>另外，用解法一的時候，<code>DatabaseOrderRepository</code> 還要負責進行資料庫的初始化連線，也有一點違反 SRP 單一職責原則的味道。總之，LSP 不是那麼難懂的東西，其實還有兩個例子可以講，是關於使用 Exception 違反 LSP 的例子和回傳值不一造成的 LSP violation，如果有時間的話再補上來吧，呵呵。看有沒有人要盯我補上的 …… 噗噗</p>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">


  <div class="article-tags">
  
  <span></span> <a href="/tags/Laradiner讀書會/">Laradiner讀書會</a><a href="/tags/程式學習/">程式學習</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://blog.dj1020.net/Laradiner讀書會-SOLID-原則(3)-Liskov-Substitution-Principle-2016-05-26/" data-title="Laradiner讀書會 - SOLID 原則(3) Liskov Substitution Principle | 閃亮亮大師之路" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 

<div class="next">
<a href="/鐵哥分享OO觀念-2016-0519/"  title="鐵哥分享OO觀念_2016_0519">
 <strong>下一篇：</strong><br/> 
 <span>鐵哥分享OO觀念_2016_0519
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#u6848_u4F8B_u524D_u7F6E_u4F5C_u696D"><span class="toc-number">1.</span> <span class="toc-text">案例前置作業</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u6309_u6B64__u67E5_u770B_u5DF2_u5B8C_u6210_u7684_Git__u6E90_u78BC_uFF0C_u904E_u7A0B_u6709_u554F_u984C_u53EF_u5230_Laravel__u53F0_u7063_u81C9_u66F8_u793E_u5718__u767C_u554F"><span class="toc-number">1.0.1.</span> <span class="toc-text">按此 查看已完成的 Git 源碼，過程有問題可到 Laravel 台灣臉書社團 發問</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u91CC_u6C0F_u66FF_u63DB_u539F_u5247__28LSP_-_Liskov_Substitution_Principle_29"><span class="toc-number">2.</span> <span class="toc-text">里氏替換原則 (LSP - Liskov Substitution Principle)</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u6700_u5E38_u898B_u7684_u932F_u8AA4_uFF1A"><span class="toc-number">2.0.1.</span> <span class="toc-text">最常見的錯誤：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u600E_u9EBC_u89E3_uFF1F"><span class="toc-number">2.0.2.</span> <span class="toc-text">怎麼解？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u73FE_u5728_u8B93_u6211_u5011_u56DE_u5230_u66F8_u4E2D_u7684_u7BC4_u4F8B_uFF1A"><span class="toc-number">3.</span> <span class="toc-text">現在讓我們回到書中的範例：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u600E_u9EBC_u89E3_uFF1F_u89E3_u6CD5_u4E00_uFF1A"><span class="toc-number">4.</span> <span class="toc-text">怎麼解？解法一：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u6211_u628A_u521D_u59CB_u5316_u7684_u52D5_u4F5C_u5F80_u4E0A_u62C9_uFF0C_u5728_u4E00_u958B_u59CB_u5C31_u521D_u59CB_u5316_uFF0C_u518D_u50B3_u5165_Main__u4E2D_u3002_u641E_u5B9A_uFF01"><span class="toc-number">4.0.1.</span> <span class="toc-text">我把初始化的動作往上拉，在一開始就初始化，再傳入 Main 中。搞定！</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u81F3_u65BC_u66F8_u4E2D_u89E3_u6CD5_u7684_u5B8C_u6574_u7BC4_u4F8B_u662F_u600E_u6A23_uFF1F_u89E3_u6CD5_u4E8C_uFF1A"><span class="toc-number">5.</span> <span class="toc-text">至於書中解法的完整範例是怎樣？解法二：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#u600E_u9EBC_u5BE6_u4F5C_DatabaseConnector__u5462_uFF1F"><span class="toc-number">5.0.1.</span> <span class="toc-text">怎麼實作 DatabaseConnector 呢？</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#u6700_u5F8C_u5C31_u662F_u600E_u9EBC_u547C_u53EB_u4F7F_u7528_uFF1F"><span class="toc-number">5.0.2.</span> <span class="toc-text">最後就是怎麼呼叫使用？</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u9583_u4EAE_u4EAE_u5C0F_u7D50"><span class="toc-number">6.</span> <span class="toc-text">閃亮亮小結</span></a></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Hexo-筆記/" title="Hexo 筆記">Hexo 筆記<sup>4</sup></a></li>
		  
		
		  
			<li><a href="/categories/程式筆記/" title="程式筆記">程式筆記<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/筆記/" title="筆記">筆記<sup>19</sup></a></li>
			
		
			
				<li><a href="/tags/PHP-Conf/" title="PHP Conf">PHP Conf<sup>8</sup></a></li>
			
		
			
				<li><a href="/tags/PHP也有Day/" title="PHP也有Day">PHP也有Day<sup>5</sup></a></li>
			
		
			
				<li><a href="/tags/Hexo/" title="Hexo">Hexo<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/程式學習/" title="程式學習">程式學習<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Laradiner讀書會/" title="Laradiner讀書會">Laradiner讀書會<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/Bootstrap/" title="Bootstrap">Bootstrap<sup>4</sup></a></li>
			
		
			
				<li><a href="/tags/TDD/" title="TDD">TDD<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/設計模式/" title="設計模式">設計模式<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/JSON/" title="JSON">JSON<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/curl/" title="curl">curl<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux/" title="Linux">Linux<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/講座/" title="講座">講座<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Laradiner/" title="Laradiner">Laradiner<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Install/" title="Install">Install<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Test-Corner/" title="Test Corner">Test Corner<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="http://oomusou.io/" target="_blank" title="Sam&#39;s 點燈坊">Sam&#39;s 點燈坊</a>
            
          </li>
        
          <li>
            
            	<a href="http://jaceju.net/" target="_blank" title="鐵哥 JaceJu&#39;s Blog">鐵哥 JaceJu&#39;s Blog</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> Hello ,I&#39;m Ken Lin in Cloud Interactive. <br/>
			This is my blog, believe it or not.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2016 
		
		<a href="/about" target="_blank" title="閃亮亮dj">閃亮亮dj</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->





<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
